"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function e(){fetch("/api/list.php").then(function(e){return e.json()}).then(function(e){renderList(JSON.parse(e))}),setTimeout(e,2e3)}();var add_button=document.getElementsByClassName("gh_add")[0],templateEditForm='\n    <div class="modalExit"></div>\n    <h3>Добавить новую игру</h3>\n    <form onsubmit="return false;">\n        <input type="text" name="title" placeholder="Название">\n        <input type="text" name="price" onkeypress="if(isNaN(String.fromCharCode(event.keyCode))) return false;" placeholder="Цена">\n        <div class="pl_case">\n            <div class="mefp_title">Платформы:</div>\n            <label><input name="platform[]" class="pl_platform" type="checkbox" value="MacOs">MacOs</label>\n            <label><input name="platform[]" class="pl_platform" type="checkbox" value="Windows">Windows</label>\n            <label><input name="platform[]" class="pl_platform" type="checkbox" value="SteamOS">SteamOS</label>\n        </div>\n        <input type="submit" value="Добавить" onclick="validForm(this.form)">\n    </form>\n',modalBg=document.getElementsByClassName("modalBg")[0],modalEdit=document.getElementsByClassName("modalEdit")[0],modalExit=document.getElementsByClassName("modalExit")[0];function modalRemove(e){"modalExit"!=e.target.classList[0]&&"modalBg"!=e.target.classList[0]||(this.bg.style.cssText="",this.me.style.cssText="")}add_button.addEventListener("click",function(e,t){e.style.cssText="display: block;",t.style.cssText="display: block;",t.innerHTML=templateEditForm}.bind(null,modalBg,modalEdit)),modalBg.addEventListener("click",{handleEvent:modalRemove,bg:modalBg,me:modalEdit}),modalEdit.addEventListener("click",{handleEvent:modalRemove,bg:modalBg,me:modalEdit});var nowData=[],oldData=[],edits=[],filter="";function renderList(e,t){var i=checkData(e,nowData),l=document.getElementsByClassName("game_table")[0];if(window.location.hash){var n=+window.location.hash.slice(1);-1==edits.indexOf(n)&&(edits.push(n),setTimeout(function(){scrollTo(document.getElementsByTagName("body")[0],document.querySelector('.gt_item[data-id="'+n+'"]').offsetTop-100,600)},100))}if(i.length||t){var a=e.reduce(function(e,t){return e+createItem(t,i)},"");l.innerHTML='<div class="gt_item">\n        <div class="gti_cell gti_title"><div class="gtic_wrap">Название</div></div>\n        <div class="gti_cell gti_price"><div class="gtic_wrap">Цена</div></div>\n        <div class="gti_cell gti_platform"><div class="gtic_wrap">Платформы</div></div>\n        <div class="gti_cell gti_desc"><div class="gtic_wrap">Описание</div></div>\n        <div class="gti_cell gti_edit"></div>\n        <div class="gti_cell gti_del"></div>\n    </div>'+a;for(var s=document.getElementsByClassName("gt_item"),c=0;c<s.length;c++){s[c].addEventListener("click",delegateItem);for(var d=s[c].querySelectorAll('form input[type="text"]'),o=0;o<d.length;o++)d[o].addEventListener("change",changeInput);var r=s[c].querySelectorAll('form input[type="checkbox"]');for(o=0;o<r.length;o++)r[o].addEventListener("change",changeChecked);var m=s[c].getElementsByClassName("desc_link")[0];0<c&&m.addEventListener("click",function(e,t){e.style.cssText="display: block;",t.style.cssText="display: block;",t.innerHTML='\n                        <div class="modalExit"></div>\n                        <h3>Описание</h3>\n                        <p class="modal_desc">Как принято считать, ключевые особенности структуры проекта ограничены исключительно \n                        образом мышления. Лишь тщательные исследования конкурентов набирают популярность \n                        среди определенных слоев населения, а значит, должны быть подвергнуты целой серии \n                        независимых исследований. В своем стремлении повысить качество жизни, они забывают, \n                        что граница обучения кадров влечет за собой процесс внедрения и модернизации экспериментов, \n                        поражающих по своей масштабности и грандиозности.</p>\n                    '}.bind(null,modalBg,modalEdit))}t||(oldData=nowData,nowData=e,i[0].length&&showLog(i))}}function createItem(i,e){if(filter&&-1==filter.indexOf(i.id))return"";if(-1==edits.indexOf(i.id))return'<div data-id="'+i.id+'" class="gt_item">\n            <div class="gti_cell gti_title"><div class="gtic_wrap">'+i.title+'</div></div>\n            <div class="gti_cell gti_price"><div class="gtic_wrap">'+i.price+'</div></div>\n            <div class="gti_cell gti_platform"><div class="gtic_wrap">'+i.platform.join(", ")+'</div></div>\n            <div class="gti_cell gti_desc"><div class="gtic_wrap"><a class="desc_link" href="#">Открыть</a></div></div>\n            <div class="gti_cell gti_edit"></div>\n            <div class="gti_cell gti_del"></div>\n        </div>';var t=document.querySelector('.gt_item[data-id="'+i.id+'"]'),l=e.reduce(function(e,t){return t[0]+1!=i.id&&e},!0);return t&&t.querySelector("form")&&l?t.outerHTML:'\n                <div data-id="'+i.id+'" class="gt_item">\n                    <form onsubmit="return false;">\n                        <input type="hidden" name="id" value="'+i.id+'" />\n                        <div class="gti_cell gti_title"><div class="gtic_wrap"><input name="title" type="text" value="'+i.title+'"/></div></div>\n                        <div class="gti_cell gti_price"><div class="gtic_wrap"><input name="price" type="text" value="'+i.price+'"/></div></div>\n                        <div class="gti_cell gti_platform">\n                            <div class="gtic_wrap pl_case">\n                                <label><input '+checkPlatform(i.platform,"MacOs")+' name="platform[]" class="pl_platform" type="checkbox" value="MacOs">MacOs</label>\n                                <label><input '+checkPlatform(i.platform,"Windows")+' name="platform[]" class="pl_platform" type="checkbox" value="Windows">Windows</label>\n                                <label><input '+checkPlatform(i.platform,"SteamOS")+' name="platform[]" class="pl_platform" type="checkbox" value="SteamOS">SteamOS</label>\n                            </div>\n                        </div>\n                        <div class="gti_cell gti_desc"><div class="gtic_wrap"><a class="desc_link" href="#">Открыть</a></div></div>\n                        <div class="gti_cell gti_complete"><input type="submit" type="submit" onclick="validForm(this.form)"/></div>\n                        <div class="gti_cell gti_del"></div>\n                    </form>\n                </div>'}function changeInput(e){e.target.setAttribute("value",e.target.value)}function changeChecked(e){e.target.checked?e.target.setAttribute("checked","true"):e.target.removeAttribute("checked")}function checkPlatform(e,t){return-1!=e.indexOf(t)?'checked="true"':""}function delegateItem(e){"gti_edit"==e.target.classList[1]&&(edits.push(+this.dataset.id),renderList(nowData,!0)),"gti_del"==e.target.classList[1]&&(modalBg.style.cssText="display: block;",modalEdit.style.cssText="display: block;",modalEdit.innerHTML='\n            <div class="modalExit"></div>\n            <p class="alarm_modal">Вы уверены что хотите удалить игру?</p>\n            <div class="btn_case"><div class="btnc_item btnc_yes">Да</div><div class="btnc_item btnc_no">Отмена</div> </div>\n        ',document.getElementsByClassName("btnc_yes")[0].addEventListener("click",function(){sendDel(this.dataset.id),modalBg.style.cssText="",modalEdit.style.cssText=""}.bind(this)),document.getElementsByClassName("btnc_no")[0].addEventListener("click",function(){modalBg.style.cssText="",modalEdit.style.cssText=""}))}function showLog(e){for(var t=e.reduce(function(e,t){return setTimeout(clearLog,5e3),e.push(createLog(t)),e},[]),i=document.getElementsByClassName("logs")[0],l=0;l<t.length;l++)i.insertBefore(t[0],i.childNodes[0])}function clearLog(){var e=document.getElementsByClassName("logs_item");e[e.length-1].style.cssText="opacity:0",setTimeout(function(){e[e.length-1].remove()},300)}function createLog(t){var e=document.createElement("div");return"add"==t[1]?(e.classList.add("logs_item","logs_add"),e.innerText='Добавлена новая игра "'+nowData[nowData.length-t[0]].title+'"'):"remove"==t[1]?(e.classList.add("logs_item","logs_remove"),e.innerText='Была удалена игра "'+oldData.find(function(e){return e.id===t[0]}).title+'"'):(e.classList.add("logs_item","logs_edit"),e.innerText='Была изменена игра "'+nowData[t[0]].title+'"'),e}function validForm(e){var t=0;""==e.title.value?(t=1,e.title.classList.add("input_error")):e.title.classList.remove("input_error"),""==e.price.value?(t=1,e.price.classList.add("input_error")):e.price.classList.remove("input_error"),[].reduce.call(e.querySelectorAll(".pl_platform"),function(e,t){return e||t.checked},!1)?e.querySelector(".pl_case").classList.remove("plcase_error"):(t=1,e.querySelector(".pl_case").classList.add("plcase_error")),t||(e.id?(edits.splice(edits.indexOf(+e.id.value),1),window.location.hash="",compareForm(nowData,e)?sendEdit(serialize(e)):renderList(nowData,!0)):(sendAdd(serialize(e)),modalBg.style.cssText="",modalEdit.style.cssText="",e.title.value="",e.price.value="",[].forEach.call(e.querySelectorAll(".pl_platform"),function(e){return e.checked=!1})))}function compareForm(e,t){var i=0,l=(e=e.find(function(e){return e.id===+t.id.value}),[].reduce.call(t.querySelectorAll(".pl_platform"),function(e,t){return t.checked&&e.push(t.value),e},[]));return e.title!=t.title.value&&(i=1),e.price!=+t.price.value&&(i=1),e.platform.join()!=l.join()&&(i=1),i}var findInput=document.getElementsByClassName("gh_find")[0];function sendAdd(e){fetch("/api/add.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:e})}function sendEdit(e){fetch("/api/edit.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:e})}function sendDel(e){fetch("/api/delete.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:"id="+e})}function checkData(e,l){if(!l.length)return[0];if(e.length>l.length){for(var t=[],i=1;i<=e.length-l.length;i++)t.push([i,"add"]);return t}return e.length<l.length?findDeleteData(e,l):e.reduce(function(e,t,i){return validObject(t,l[i],i,e)},[])}function validObject(e,t,i,l){for(var n=(0,Object.keys)(e),a=0;a<n.length;a++)"object"==_typeof(e[n[a]])?e[n[a]].length!=t[n[a]].length&&l.push([i,n[a]]):e[n[a]]!=t[n[a]]&&l.push([i,n[a]]);return l}function findDeleteData(e,t){var i=[];e=e.map(function(e){return e.id}),t=t.map(function(e){return e.id});for(var l=0;l<t.length;l++)-1==e.indexOf(t[l])&&i.push([t[l],"remove"]);return i}function serialize(e){for(var t=[],i=0;i<e.elements.length;i++){var l=e.elements[i];if(l.name&&!l.disabled&&"file"!==l.type&&"reset"!==l.type&&"submit"!==l.type&&"button"!==l.type)if("select-multiple"===l.type)for(var n=0;n<l.options.length;n++)l.options[n].selected&&t.push(encodeURIComponent(l.name)+"="+encodeURIComponent(l.options[n].value));else("checkbox"!==l.type&&"radio"!==l.type||l.checked)&&t.push(encodeURIComponent(l.name)+"="+encodeURIComponent(l.value))}return t.join("&")}function scrollTo(e,t,i){if(!(i<=0)){var l=(t-e.scrollTop)/i*10;setTimeout(function(){e.scrollTop=e.scrollTop+l,e.scrollTop!==t&&scrollTo(e,t,i-10)},10)}}findInput.addEventListener("keyup",function(e){var l=e.target.value;filter=l?nowData.reduce(function(e,t){var i=t.title.replace(/\./gi,"").toLowerCase().match("^"+l.toLowerCase());return l&&i&&i.length&&e.push(t.id),e},[]):"",renderList(nowData,!0)});