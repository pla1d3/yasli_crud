"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}fetch("/api/list.php").then(function(t){return t.json()}).then(function(t){renderList(JSON.parse(t))});var nowData=[],dataSort=[];function renderList(t,e){if(window.location.search){var n=parseQuery(window.location.search),r=document.getElementsByClassName("gf_itemActive")[0];r&&r.classList.remove("gf_itemActive"),document.querySelector('.gf_item[data-sort="'+n.method_sort+'"]').classList.add("gf_itemActive"),dataSort=sortData(t,n.method_sort)}else document.querySelector('.gf_item[data-sort="all"]').classList.add("gf_itemActive"),dataSort=null;console.log(dataSort),console.log(nowData);var a=checkData(t,nowData),i=document.getElementsByClassName("game_case")[0];if(a.length||e){if(dataSort)var o=dataSort.reduce(function(t,e){return t+createItem(e)},"");else o=t.reduce(function(t,e){return t+createItem(e)},"");i.innerHTML=o;for(var s=document.getElementsByClassName("stars"),c=document.getElementsByClassName("now_rate"),l=0;l<s.length;l++)!function(e){var n=s[e].querySelectorAll(".star");s[e].addEventListener("mouseover",function(t){c[e].style.cssText="opacity:0",selectStars(t.target.dataset.id,n)}),s[e].addEventListener("mouseout",function(){c[e].style.cssText="",clearStars(n)}),setEventListStarts(e+1,n)}(l);nowData=t}}function createItem(t){return t.text="Как принято считать, ключевые особенности структуры проекта ограничены исключительно образом мышления. \n        Лишь тщательные исследования конкурентов набирают популярность среди определенных слоев \n        населения, а значит, должны быть подвергнуты целой серии независимых исследований. \n        В своем стремлении повысить качество жизни, они забывают, что граница обучения \n        кадров влечет за собой процесс внедрения и модернизации экспериментов, \n        поражающих по своей масштабности и грандиозности.",'\n        <div class="gc_item">\n            <div class="gci_top">\n                <a class="link" href="/game?id='+t.id+'"></a>\n                <h3>'+t.title+'</h3>\n                <div class="platform">'+getPlatform(t.platform)+'</div>\n                <div class="gcisi_rate">\n                    <div class="gcisi_vis">\n                        <div class="now_rate" style="'+getStyleRate(t.id,t.rating)+'"></div>\n                        <div class="stars">'+getStarts(t.id)+"</div>\n                    </div>\n                    <p>"+(parseFloat(t.rating).toFixed(1)||"0.0")+'</p>\n                </div>\n                <div class="price">'+getPrice(t.price)+'</div>\n                <p class="desc">'+t.text.slice(0,200).replace(/[., ]$/,"")+'...</p>\n            </div>\n            <div class="gci_bottom">\n                <a href="/edit#'+t.id+'" class="gcib_edit">Править</a>\n            </div>\n         </div>\n    '}for(var sort_links=document.querySelectorAll(".gf_item:not(.gf_head)"),i=0;i<sort_links.length;i++)sort_links[i].addEventListener("click",function(t){var e=t.target.dataset.sort,n=document.getElementsByClassName("gf_itemActive")[0];n&&n.classList.remove("gf_itemActive"),"all"==e?history.pushState({state:"method_sort"},null,"?"):history.pushState({state:"method_sort"},null,"?method_sort="+e),t.target.classList.add("gf_itemActive"),renderList(nowData,!0)});function sortData(t,e){var n=t.slice();return"names"==e?n.sort(function(t,e){return t.title[0].toLowerCase()<e.title[0].toLowerCase()?-1:t.title[0].toLowerCase()>e.title[0].toLowerCase()?1:0}):"rate_up"==e?n.sort(function(t,e){return t.rating<e.rating?-1:t.rating>e.rating?1:0}):"rate_down"==e?n.sort(function(t,e){return t.rating>e.rating?-1:t.rating<e.rating?1:0}):void 0}function getPlatform(t){return t.reduce(function(t,e){return t+'<div class="platform_item '+e.toLowerCase()+'"><i></i><p>'+e+"</p></div>"},"")}function getStarts(t){for(var e="",n=getVotesRate(t),r=1;r<=10;r++)e+=n<r?'<div data-id="'+r+'" class="star"></div>':'<div data-id="'+r+'" class="star starActive"></div>';return e}function getStyleRate(t,e){return getVotesRate(t)?"":"width:"+10*e+"%"}function getVotesRate(n){return(JSON.parse(localStorage.getItem("votes"))||[]).reduce(function(t,e){return e.id==n?e.rate:t},0)||0}function getPrice(t){return"0"==t?"Бесплатно":t+" руб."}function selectStars(t,e){for(var n=0;n<e.length;n++)n<t&&e[n].classList.add("starSelect")}function clearStars(t){for(var e=0;e<t.length;e++)t[e].classList.remove("starSelect")}function setEventListStarts(o,t){for(var e=0;e<t.length;e++)t[e].addEventListener("click",function(t){var e=t.target.dataset.id,n=JSON.parse(localStorage.getItem("votes"))||[],r="id="+o+"&rating="+e,a=getVotesRate(o);a&&(r+="&old="+a),fetch("/api/vote.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:r}).then(function(){renderList(nowData,!0)});var i=n.reduce(function(t,e,n){return e.id==o?n:t},null);null!=i?n[i].rate=e:n.push({id:o,rate:e}),localStorage.setItem("votes",JSON.stringify(n))},o)}function checkData(t,r){if(!r.length)return[0];if(t.length>r.length){for(var e=[],n=1;n<=t.length-r.length;n++)e.push([n,"add"]);return e}return t.length<r.length?findDeleteData(t,r):t.reduce(function(t,e,n){return validObject(e,r[n],n,t)},[])}function validObject(t,e,n,r){for(var a=(0,Object.keys)(t),i=0;i<a.length;i++)"object"==_typeof(t[a[i]])?t[a[i]].length!=e[a[i]].length&&r.push([n,a[i]]):t[a[i]]!=e[a[i]]&&r.push([n,a[i]]);return r}function findDeleteData(t,e){var n=[];t=t.map(function(t){return t.id}),e=e.map(function(t){return t.id});for(var r=0;r<e.length;r++)-1==t.indexOf(e[r])&&n.push([e[r],"remove"]);return n}function parseQuery(t){for(var e={},n=("?"===t[0]?t.substr(1):t).split("&"),r=0;r<n.length;r++){var a=n[r].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]||"")}return e}